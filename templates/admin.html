<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TN Gov - Official Admin Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Roboto', Arial, sans-serif; 
            background: linear-gradient(135deg, #FF9933 0%, #FFFFFF 50%, #128807 100%); 
            color: #333; margin: 0; padding: 0; animation: fadeIn 1s ease-in; 
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        header { 
            background: linear-gradient(90deg, #FF9933, #FFCC99); 
            color: #FFFFFF; padding: 30px; text-align: center; 
            border-bottom: 5px solid #128807; box-shadow: 0 4px 10px rgba(0,0,0,0.2); 
            position: relative;
        }

        /* Top Left Small Button Style */
        #langToggle {
            position: absolute; top: 10px; left: 10px;
            background: #128807; color: white; border: none;
            padding: 5px 12px; border-radius: 4px; cursor: pointer;
            font-size: 12px; font-weight: bold; transition: 0.3s;
            z-index: 1000;
        }
        #langToggle:hover { background: #0a5a04; transform: scale(1.05); }

        .container { 
            max-width: 900px; margin: 30px auto; padding: 30px; 
            background: rgba(255,255,255,0.95); border-radius: 15px; 
            box-shadow: 0 8px 20px rgba(0,0,0,0.15); border: 3px solid #FF9933; 
            backdrop-filter: blur(10px); 
        }

        .admin-panel { 
            background: #f0f4f8; padding: 25px; border-radius: 10px; 
            margin-top: 25px; border-left: 5px solid #FF9933; 
        }

        input, select, button.main-action { 
            padding: 15px; margin-top: 10px; border: 2px solid #ccc; 
            border-radius: 10px; font-size: 16px; width: 100%; box-sizing: border-box;
        }

        button.main-action { 
            background: linear-gradient(45deg, #128807, #0F6B3A); 
            color: #FFFFFF; cursor: pointer; font-weight: 700; border: none; 
            transition: transform 0.2s; 
        }
        button.main-action:hover { transform: scale(1.02); background: #0F6B3A; }

        .status-table { 
            width: 100%; border-collapse: collapse; margin-top: 20px; background: white; 
        }
        .status-table th, .status-table td { 
            border: 1px solid #ddd; padding: 12px; text-align: left; 
        }
        .status-table th { background-color: #128807; color: white; }

        .analytics { 
            background: #fff3e0; padding: 15px; border-radius: 10px; 
            margin-bottom: 20px; border-left: 5px solid #e65100;
        }
    </style>
</head>
<body>

<header>
    <button id="langToggle" onclick="toggleLanguage()">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç / EN</button>
    
    <h1 id="headerTitle">üèõÔ∏è TN Official Grievance Dashboard</h1>
    <p id="headerSub">Staff Access Only - Secure Status Management</p>
</header>

<div class="container">
    <div class="analytics">
        <h3 id="statsTitle">Live Portal Statistics üìä</h3>
        <p id="statsDisplay">Total: 0 | Resolved: 0 | Pending: 0</p>
    </div>

    <div id="adminPanel" class="admin-panel">
        <h3 id="controlTitle">Admin Controls (Staff Only) üîë</h3>
        <label id="lblId">Enter Grievance ID to Update:</label>
        <input type="text" id="adminId" placeholder="e.g., TN-1234">
        
        <label id="lblStatus">Select New Status:</label>
        <select id="newStatus">
            </select>
        
        <button class="main-action" id="btnUpdate" onclick="updateStatus()">Update Petition Status ‚úÖ</button>
    </div>

    <div class="admin-panel" style="background: white; border-left-color: #128807;">
        <h3 id="listTitle">Incoming Petitions List</h3>
        <div style="overflow-x: auto;">
            <table class="status-table">
                <thead>
                    <tr>
                        <th id="thId">ID</th>
                        <th id="thCitizen">Citizen</th>
                        <th id="thCategory">Category (AI)</th>
                        <th id="thStatus">Current Status</th>
                    </tr>
                </thead>
                <tbody id="petitionTableBody">
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    let isTamil = false;
    // Shared Database with User Side
    let grievances = JSON.parse(localStorage.getItem('tn_db_final')) || [];

    const translations = {
        en: {
            headerTitle: "üèõÔ∏è TN Official Grievance Dashboard",
            headerSub: "Staff Access Only - Secure Status Management",
            statsTitle: "Live Portal Statistics üìä",
            controlTitle: "Admin Controls (Staff Only) üîë",
            lblId: "Enter Grievance ID to Update:",
            lblStatus: "Select New Status:",
            btnUpdate: "Update Petition Status ‚úÖ",
            listTitle: "Incoming Petitions List",
            thId: "ID",
            thCitizen: "Citizen",
            thCategory: "Category (AI)",
            thStatus: "Current Status",
            statusOptions: ["Under Review", "In Progress", "Resolved"],
            statsPrefix: "Total", statsResolved: "Resolved", statsPending: "Pending",
            btnLang: "‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç",
            alertSuccess: "Updated successfully to",
            alertError: "ID not found."
        },
        ta: {
            headerTitle: "üèõÔ∏è ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç‡Æ®‡Ææ‡Æü‡ØÅ ‡ÆÖ‡Æ∞‡Æö‡ØÅ ‡ÆÖ‡Æ§‡Æø‡Æï‡Ææ‡Æ∞‡Æ™‡Øç‡Æ™‡ØÇ‡Æ∞‡Øç‡Æµ ‡ÆÆ‡Øá‡Æ≤‡Ææ‡Æ£‡Øç‡ÆÆ‡Øà",
            headerSub: "‡Æ™‡Æ£‡Æø‡ÆØ‡Ææ‡Æ≥‡Æ∞‡Øç ‡ÆÖ‡Æ£‡ØÅ‡Æï‡Æ≤‡Øç ‡ÆÆ‡Æü‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç - ‡Æ®‡Æø‡Æ≤‡Øà ‡ÆÆ‡Øá‡Æ≤‡Ææ‡Æ£‡Øç‡ÆÆ‡Øà",
            statsTitle: "‡Æ®‡Øá‡Æ∞‡Æü‡Æø ‡Æ™‡ØÅ‡Æ≥‡Øç‡Æ≥‡Æø‡Æµ‡Æø‡Æµ‡Æ∞‡Æô‡Øç‡Æï‡Æ≥‡Øç üìä",
            controlTitle: "‡Æ®‡Æø‡Æ∞‡Øç‡Æµ‡Ææ‡Æï‡Æï‡Øç ‡Æï‡Æü‡Øç‡Æü‡ØÅ‡Æ™‡Øç‡Æ™‡Ææ‡Æü‡ØÅ‡Æï‡Æ≥‡Øç (‡ÆÖ‡Æ§‡Æø‡Æï‡Ææ‡Æ∞‡Æø‡Æï‡Æ≥‡Øç ‡ÆÆ‡Æü‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç) üîë",
            lblId: "‡ÆÆ‡Æ©‡ØÅ‡Æµ‡Æø‡Æ©‡Øç ‡Æê‡Æü‡Æø‡ÆØ‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç:",
            lblStatus: "‡Æ™‡ØÅ‡Æ§‡Æø‡ÆØ ‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç:",
            btnUpdate: "‡ÆÆ‡Æ©‡ØÅ‡Æµ‡Æø‡Æ©‡Øç ‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ‡Øà ‡ÆÆ‡Ææ‡Æ±‡Øç‡Æ±‡Æµ‡ØÅ‡ÆÆ‡Øç ‚úÖ",
            listTitle: "‡ÆÆ‡Æ©‡ØÅ‡Æï‡Øç‡Æï‡Æ≥‡Æø‡Æ©‡Øç ‡Æ™‡Æü‡Øç‡Æü‡Æø‡ÆØ‡Æ≤‡Øç",
            thId: "‡Æê‡Æü‡Æø (ID)",
            thCitizen: "‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øç",
            thCategory: "‡Æµ‡Æï‡Øà (AI)",
            thStatus: "‡Æ§‡Æ±‡Øç‡Æ™‡Øã‡Æ§‡Øà‡ÆØ ‡Æ®‡Æø‡Æ≤‡Øà",
            statusOptions: ["‡ÆÜ‡ÆØ‡Øç‡Æµ‡Æø‡Æ≤‡Øç ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æ§‡ØÅ", "‡Æö‡ØÜ‡ÆØ‡Æ≤‡Øç‡Æ™‡Ææ‡Æü‡Øç‡Æü‡Æø‡Æ≤‡Øç ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æ§‡ØÅ", "‡Æ§‡ØÄ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ"],
            statsPrefix: "‡ÆÆ‡Øä‡Æ§‡Øç‡Æ§‡ÆÆ‡Øç", statsResolved: "‡Æ§‡ØÄ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æµ‡Øà", statsPending: "‡Æ®‡Æø‡Æ≤‡ØÅ‡Æµ‡Øà‡ÆØ‡Æø‡Æ≤‡Øç ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æµ‡Øà",
            btnLang: "English",
            alertSuccess: "‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø‡Æï‡Æ∞‡ÆÆ‡Ææ‡Æï ‡ÆÆ‡Ææ‡Æ±‡Øç‡Æ±‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ",
            alertError: "‡Æê‡Æü‡Æø ‡Æï‡Ææ‡Æ£‡Æ™‡Øç‡Æ™‡Æü‡Æµ‡Æø‡Æ≤‡Øç‡Æ≤‡Øà."
        }
    };

    function toggleLanguage() {
        isTamil = !isTamil;
        updateUI();
    }

    function updateUI() {
        const t = isTamil ? translations.ta : translations.en;
        
        document.getElementById('headerTitle').innerText = t.headerTitle;
        document.getElementById('headerSub').innerText = t.headerSub;
        document.getElementById('statsTitle').innerText = t.statsTitle;
        document.getElementById('controlTitle').innerText = t.controlTitle;
        document.getElementById('lblId').innerText = t.lblId;
        document.getElementById('lblStatus').innerText = t.lblStatus;
        document.getElementById('btnUpdate').innerText = t.btnUpdate;
        document.getElementById('listTitle').innerText = t.listTitle;
        document.getElementById('thId').innerText = t.thId;
        document.getElementById('thCitizen').innerText = t.thCitizen;
        document.getElementById('thCategory').innerText = t.thCategory;
        document.getElementById('thStatus').innerText = t.thStatus;
        document.getElementById('langToggle').innerText = t.btnLang;

        const select = document.getElementById('newStatus');
        select.innerHTML = "";
        t.statusOptions.forEach((opt, index) => {
            const option = document.createElement('option');
            option.value = translations.en.statusOptions[index];
            option.innerText = opt;
            select.appendChild(option);
        });

        renderTable();
        updateStats();
    }

    function renderTable() {
        const t = isTamil ? translations.ta : translations.en;
        const body = document.getElementById('petitionTableBody');
        body.innerHTML = grievances.map(g => {
            const statusIdx = translations.en.statusOptions.indexOf(g.status);
            const displayStatus = statusIdx !== -1 ? t.statusOptions[statusIdx] : g.status;
            return `
                <tr>
                    <td><b>${g.id}</b></td>
                    <td>${g.name}</td>
                    <td>${g.dept || 'General'}</td>
                    <td><span style="color: ${g.status === 'Resolved' ? 'green' : 'orange'}; font-weight: bold;">${displayStatus}</span></td>
                </tr>
            `;
        }).reverse().join('');
    }

    function updateStatus() {
        const id = document.getElementById('adminId').value.trim().toUpperCase();
        const status = document.getElementById('newStatus').value;
        const index = grievances.findIndex(g => g.id === id);
        const t = isTamil ? translations.ta : translations.en;

        if (index !== -1) {
            grievances[index].status = status;
            localStorage.setItem('tn_db_final', JSON.stringify(grievances));
            alert(`ID ${id} ${t.alertSuccess} ${status}!`);
            document.getElementById('adminId').value = "";
            renderTable();
            updateStats();
        } else {
            alert(t.alertError);
        }
    }

    function updateStats() {
        const t = isTamil ? translations.ta : translations.en;
        const total = grievances.length;
        const resolved = grievances.filter(g => g.status === "Resolved").length;
        const pending = total - resolved;
        document.getElementById('statsDisplay').innerText = 
            `${t.statsPrefix}: ${total} | ${t.statsResolved}: ${resolved} | ${t.statsPending}: ${pending}`;
    }

    window.onload = updateUI;
</script>

</body>
</html>