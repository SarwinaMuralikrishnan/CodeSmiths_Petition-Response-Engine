<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TN Gov Grievance Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Roboto', Arial, sans-serif; 
            background: linear-gradient(135deg, #FF9933 0%, #FFFFFF 50%, #128807 100%); 
            color: #333; 
            margin: 0; 
            padding: 0; 
            animation: fadeIn 1s ease-in; 
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        header { 
            background: linear-gradient(90deg, #FF9933, #FFCC99); 
            color: #FFFFFF; 
            padding: 30px; 
            text-align: center; 
            border-bottom: 5px solid #128807; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.2); 
            position: relative; 
        }
        header img { width: 100px; height: auto; border-radius: 50%; background: white; padding: 5px; }
        .container { 
            max-width: 900px; 
            margin: 30px auto; 
            padding: 30px; 
            background: rgba(255,255,255,0.95); 
            border-radius: 15px; 
            box-shadow: 0 8px 20px rgba(0,0,0,0.15); 
            border: 3px solid #FF9933; 
            backdrop-filter: blur(10px); 
        }
        form { display: flex; flex-direction: column; gap: 15px; }
        label { margin-top: 10px; font-weight: 700; color: #128807; }
        input, textarea, button, select { 
            padding: 15px; 
            margin-top: 5px; 
            border: 2px solid #ccc; 
            border-radius: 10px; 
            font-size: 16px; 
        }
        button { 
            background: linear-gradient(45deg, #128807, #0F6B3A); 
            color: #FFFFFF; 
            cursor: pointer; 
            font-weight: 700; 
            border: none; 
            transition: transform 0.2s; 
        }
        button:hover { transform: scale(1.02); background: #0F6B3A; }
        .urgent { color: #d9534f; font-weight: bold; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }
        #status { 
            padding: 15px; 
            margin-top: 10px;
            background: #f8f9fa; 
            border: 2px solid #128807; 
            border-radius: 10px; 
        }
        footer { 
            text-align: center; 
            padding: 20px; 
            background: #333; 
            color: #FFFFFF; 
            margin-top: 30px; 
        }
        nav { position: absolute; top: 10px; right: 20px; }
        nav a { color: #FFFFFF; margin: 0 10px; text-decoration: none; font-size: 0.9em; }
        
        /* NEW FEATURE: Small Button Top Left */
        #langToggle { position: absolute; top: 10px; left: 10px; background: #128807; color: #fff; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px; font-weight: bold; }
        
        .sync-pulse { animation: pulse 2s infinite; color: #128807; font-weight: bold; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
        
        .analytics { background: #f0f4f8; padding: 20px; border-radius: 10px; margin-top: 25px; border-left: 5px solid #FF9933; }
    </style>
</head>
<body>

    <header>
        <button id="langToggle" onclick="toggleLanguage()">à®¤à®®à®¿à®´à¯ / English</button>
        
        <nav>
            <a href="https://www.tn.gov.in/" target="_blank">ğŸ›ï¸ TN Gov</a>
            <a href="https://www.india.gov.in/" target="_blank">ğŸ‡®ğŸ‡³ India Portal</a>
        </nav>
        <img src="https://upload.wikimedia.org/wikipedia/commons/8/81/TamilNadu_Logo.svg" alt="TN Logo">
        <h1 id="title">Tamil Nadu Grievance Portal</h1>
        <p id="subtitle">Digitalizing Public Service for a Better Tomorrow.</p>
    </header>

    <div class="container">
        <div class="analytics">
            <h3 id="statsTitle">Portal Statistics ğŸ“Š</h3>
            <p id="statsDisplay">Total Grievances: 0 | Resolved: 0</p>
            <p id="syncMsg" style="font-size: 12px; color: #666;">Status: Connected locally</p>
            <button onclick="simulateSync()" style="font-size: 11px; width: auto; padding: 5px 10px; background: #555;">ğŸ”„ Sync with Gov Data</button>
        </div>

        <h2 id="submitTitle">Submit Your Grievance ğŸ“</h2>
        <form id="grievanceForm">
            <label id="nameLabel">Full Name:</label>
            <input type="text" id="name" placeholder="Enter your name" required>

            <label id="emailLabel">Email Address:</label>
            <input type="email" id="email" placeholder="example@mail.com" required>

            <label id="categoryLabel">Category:</label>
            <select id="category">
                <option value="General">General</option>
                <option value="TNEB">Electricity (TNEB)</option>
                <option value="PDS">Ration/PDS</option>
                <option value="Safety">Public Safety</option>
                <option value="Water">Water Supply</option>
            </select>

            <label id="descLabel">Grievance Description:</label>
            <textarea id="description" rows="4" placeholder="AI will categorize this automatically..." required></textarea>

            <label id="captchaLabel">Security Check: What is 5 + 3?</label>
            <input type="number" id="captcha" required>

            <button type="submit" id="submitBtn">Submit Securely âœ…</button>
        </form>

        <div id="tracking" style="margin-top: 40px;">
            <h2 id="trackTitle">Track Grievance ğŸ”</h2>
            <input type="text" id="trackingId" placeholder="Enter ID (e.g., TN-1234)">
            <button onclick="trackGrievance()" id="trackBtn" style="width: 100%;">Track Status</button>
            <div id="status">Status will appear here...</div>
        </div>
    </div>

    <footer>
        <p>&copy; 2026 Government of Tamil Nadu. All rights reserved.</p>
    </footer>

    <script>
        // Use the SAME KEY as admin.html
        const DB_KEY = 'tn_db_final';
        let grievances = JSON.parse(localStorage.getItem(DB_KEY)) || [];
        let isTamil = false;

        // NEW FEATURE: Multilingual Toggle Logic
        function toggleLanguage() {
            isTamil = !isTamil;
            document.getElementById('title').innerText = isTamil ? "à®¤à®®à®¿à®´à¯à®¨à®¾à®Ÿà¯ à®…à®°à®šà¯ à®ªà¯à®•à®¾à®°à¯ à®¤à®³à®®à¯" : "Tamil Nadu Grievance Portal";
            document.getElementById('subtitle').innerText = isTamil ? "à®šà®¿à®±à®¨à¯à®¤ à®¨à®¾à®³à¯ˆà®•à¯à®•à®¾à®• à®ªà¯Šà®¤à¯ à®šà¯‡à®µà¯ˆà®¯à¯ˆ à®Ÿà®¿à®œà®¿à®Ÿà¯à®Ÿà®²à¯ à®®à®¯à®®à®¾à®•à¯à®•à¯à®¤à®²à¯." : "Digitalizing Public Service for a Better Tomorrow.";
            document.getElementById('submitTitle').innerText = isTamil ? "à®‰à®™à¯à®•à®³à¯ à®®à®©à¯à®µà¯ˆà®šà¯ à®šà®®à®°à¯à®ªà¯à®ªà®¿à®•à¯à®•à®µà¯à®®à¯ ğŸ“" : "Submit Your Grievance ğŸ“";
            document.getElementById('trackTitle').innerText = isTamil ? "à®®à®©à¯à®µà¯ˆ à®•à®£à¯à®•à®¾à®£à®¿à®•à¯à®• ğŸ”" : "Track Grievance ğŸ”";
            updateStats();
        }

        // NEW FEATURE: AI Classification Logic
        function aiClassify(text) {
            const desc = text.toLowerCase();
            if (desc.includes('power') || desc.includes('current') || desc.includes('tneb')) return "TNEB";
            if (desc.includes('ration') || desc.includes('pds') || desc.includes('rice')) return "PDS";
            if (desc.includes('water') || desc.includes('pipe') || desc.includes('leak')) return "Water";
            if (desc.includes('police') || desc.includes('safety') || desc.includes('crime')) return "Safety";
            return "General";
        }

        // NEW FEATURE: Real-time Data Integration Sync simulation
        function simulateSync() {
            const msg = document.getElementById('syncMsg');
            msg.innerHTML = '<span class="sync-pulse">Fetching updates from Central Server...</span>';
            setTimeout(() => {
                msg.innerText = "âœ… Synced with TN Gov Portal: " + new Date().toLocaleTimeString();
                updateStats();
            }, 1500);
        }

        // Submit Grievance logic
        document.getElementById('grievanceForm').addEventListener('submit', function(e) {
            e.preventDefault();
            if (document.getElementById('captcha').value !== "8") { alert("Wrong Captcha!"); return; }

            const desc = document.getElementById('description').value;
            const aiDept = aiClassify(desc); // AI categorization
            const id = "TN-" + Math.floor(1000 + Math.random() * 9000);

            const newEntry = {
                id: id,
                name: document.getElementById('name').value,
                description: desc,
                dept: aiDept,
                status: "Under Review",
                date: new Date().toLocaleDateString()
            };

            grievances.push(newEntry);
            localStorage.setItem(DB_KEY, JSON.stringify(grievances));
            
            alert(isTamil ? "à®šà®®à®°à¯à®ªà¯à®ªà®¿à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯! à®‰à®™à¯à®•à®³à¯ à®à®Ÿà®¿: " + id : "Success! Your ID is: " + id);
            this.reset();
            updateStats();
        });

        // Track Grievance (Reflects Admin Updates)
        function trackGrievance() {
            const db = JSON.parse(localStorage.getItem(DB_KEY)) || [];
            const id = document.getElementById('trackingId').value.toUpperCase();
            const found = db.find(g => g.id === id);
            const statusBox = document.getElementById('status');
            
            if (found) {
                statusBox.innerHTML = `<strong>ID:</strong> ${found.id} | <strong>Status:</strong> <span style="color:#128807">${found.status}</span><br><small>Assigned Dept: ${found.dept}</small>`;
            } else {
                statusBox.innerHTML = "<span style='color:red'>ID not found. Please try again.</span>";
            }
        }

        function updateStats() {
            const db = JSON.parse(localStorage.getItem(DB_KEY)) || [];
            const total = db.length;
            const resolved = db.filter(g => g.status === "Resolved").length;
            document.getElementById('statsDisplay').innerText = isTamil ? 
                `à®®à¯Šà®¤à¯à®¤ à®ªà¯à®•à®¾à®°à¯à®•à®³à¯: ${total} | à®¤à¯€à®°à¯à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®µà¯ˆ: ${resolved}` : 
                `Total Grievances: ${total} | Resolved: ${resolved}`;
        }

        window.onload = updateStats;
    </script>
</body>
</html>